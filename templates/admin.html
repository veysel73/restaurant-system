<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #ecf0f1; }
        
        .header {
            background: #8e44ad; color: white; padding: 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .header h1 { font-size: 28px; }
        .logout-btn {
            padding: 10px 20px; background: #e74c3c; color: white;
            border: none; border-radius: 5px; cursor: pointer;
        }
        
        .container { padding: 20px; }
        
        .tabs {
            display: flex; gap: 10px; margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 15px 30px; background: white; border: none;
            border-radius: 5px; cursor: pointer; font-size: 16px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .tab.active { background: #8e44ad; color: white; }
        
        .content-section {
            background: white; padding: 30px; border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block; margin-bottom: 8px;
            font-weight: bold; color: #2c3e50;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 12px; border: 2px solid #ecf0f1;
            border-radius: 5px; font-size: 16px;
        }
        .form-group small {
            color: #7f8c8d; font-size: 14px;
        }
        
        .image-upload-section {
            margin-top: 15px; padding: 20px;
            background: #f8f9fa; border-radius: 5px;
            border: 2px dashed #ddd;
        }
        .image-preview {
            margin-top: 15px; text-align: center;
        }
        .image-preview img {
            max-width: 300px; max-height: 200px;
            border-radius: 5px; object-fit: cover;
        }
        
        .btn {
            padding: 12px 30px; border: none; border-radius: 5px;
            cursor: pointer; font-size: 16px; font-weight: bold;
        }
        .btn-primary { background: #8e44ad; color: white; }
        .btn-success { background: #27ae60; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        
        .menu-list {
            margin-top: 30px;
        }
        .menu-item-row {
            display: flex; justify-content: space-between;
            align-items: center; padding: 15px;
            background: #ecf0f1; margin-bottom: 10px;
            border-radius: 5px;
        }
        .menu-item-image-small {
            width: 80px; height: 60px;
            object-fit: cover; border-radius: 5px;
            margin-right: 15px;
        }
        .menu-item-info { 
            flex: 1; 
            display: flex;
            align-items: center;
        }
        .menu-item-actions {
            display: flex; gap: 10px;
        }
        
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 30px; border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 48px; font-weight: bold; margin-bottom: 10px;
        }
        .stat-label {
            font-size: 18px; opacity: 0.9;
        }
        
        .report-filters {
            display: flex; gap: 15px; margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        table {
            width: 100%; border-collapse: collapse;
        }
        th, td {
            padding: 12px; text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        th {
            background: #8e44ad; color: white;
        }
        tr:hover { background: #f8f9fa; }
        
        .tab-buttons {
            display: flex; gap: 10px; margin-bottom: 15px;
        }
        .tab-btn {
            padding: 10px 20px; background: #ecf0f1;
            border: none; border-radius: 5px; cursor: pointer;
        }
        .tab-btn.active { background: #8e44ad; color: white; }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚öôÔ∏è Admin Paneli</h1>
        <button class="logout-btn" onclick="logout()">√áƒ±kƒ±≈ü Yap</button>
    </div>
    
    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="showTab('menu')">Men√º Y√∂netimi</button>
            <button class="tab" onclick="showTab('qr')">QR Kod Y√∂netimi</button>
            <button class="tab" onclick="showTab('reports')">Raporlar</button>
            <!-- <button class="tab" onclick="showTab('users')">Kullanƒ±cƒ± Y√∂netimi</button> -->
        </div>
        
        <!-- Men√º Y√∂netimi -->
        <div id="menuTab" class="content-section">
            <h2 style="margin-bottom: 20px;">Men√º Y√∂netimi</h2>
            
            <form id="menuForm">
                <input type="hidden" id="itemId">
                
                <div class="form-group">
                    <label>√úr√ºn Adƒ±</label>
                    <input type="text" id="itemName" required>
                </div>
                
                <div class="form-group">
                    <label>Fiyat (‚Ç∫)</label>
                    <input type="number" id="itemPrice" required>
                </div>
                
                <div class="form-group">
                    <label>Kategori</label>
                    <select id="itemCategory" required></select>
                </div>
                
                <div class="form-group">
                    <label>√úr√ºn Resmi</label>
                    <div class="tab-buttons">
                        <button type="button" class="tab-btn active" onclick="switchImageMode('url')">URL Gir</button>
                        <button type="button" class="tab-btn" onclick="switchImageMode('upload')">Y√ºkle</button>
                    </div>
                    
                    <div id="urlMode">
                        <input type="text" id="itemImageUrl" placeholder="https://example.com/image.jpg">
                        <small>Resim URL'sini buraya yapƒ±≈ütƒ±rƒ±n</small>
                    </div>
                    
                    <div id="uploadMode" style="display: none;">
                        <div class="image-upload-section">
                            <input type="file" id="itemImageFile" accept="image/*" onchange="previewImage()">
                            <small>JPG, PNG veya WebP formatƒ±nda resim se√ßin</small>
                        </div>
                    </div>
                    
                    <div class="image-preview" id="imagePreview" style="display: none;">
                        <img id="previewImg" src="" alt="√ñnizleme">
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" id="submitBtn">√úr√ºn Ekle</button>
                <button type="button" class="btn" style="background: #95a5a6; color: white; margin-left: 10px;" onclick="resetForm()">ƒ∞ptal</button>
            </form>
            
            <div class="menu-list" id="menuList"></div>
        </div>
        
        <!-- QR Kod Y√∂netimi -->
        <div id="qrTab" class="content-section" style="display: none;">
            <h2 style="margin-bottom: 20px;">QR Kod Y√∂netimi</h2>
            
            <div style="margin-bottom: 30px; padding: 20px; background: #e8f5e9; border-radius: 10px;">
                <h3 style="color: #27ae60; margin-bottom: 10px;">üì± Nasƒ±l √áalƒ±≈üƒ±r?</h3>
                <p style="color: #2c3e50; line-height: 1.6;">
                    Her masa i√ßin √∂zel QR kod olu≈üturun. M√º≈üteriler QR kodu okuttuƒüunda, 
                    masa numarasƒ± otomatik se√ßili ≈üekilde sipari≈ü ekranƒ± a√ßƒ±lƒ±r.
                </p>
            </div>
            
            <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 10px; font-weight: bold;">Masa Se√ßin</label>
                    <select id="qrTableSelect" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 5px; font-size: 16px;">
                        <option value="">Masa se√ßin...</option>
                    </select>
                </div>
                <div style="display: flex; align-items: flex-end;">
                    <button class="btn btn-primary" onclick="generateQR()" style="padding: 12px 30px;">QR Kod Olu≈ütur</button>
                </div>
            </div>
            
            <div id="qrResult" style="display: none;">
                <div style="background: white; padding: 30px; border-radius: 10px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px; color: #2c3e50;">Masa <span id="qrTableNumber"></span> QR Kodu</h3>
                    <img id="qrImage" src="" alt="QR Kod" style="max-width: 300px; border: 3px solid #ecf0f1; border-radius: 10px; padding: 20px;">
                    <div style="margin-top: 20px;">
                        <p style="color: #7f8c8d; margin-bottom: 15px;">
                            <strong>URL:</strong> <span id="qrUrl" style="color: #3498db;"></span>
                        </p>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button class="btn btn-success" onclick="downloadQR()">üíæ ƒ∞ndir</button>
                            <button class="btn btn-primary" onclick="printQR()">üñ®Ô∏è Yazdƒ±r</button>
                            <button class="btn" style="background: #3498db; color: white;" onclick="downloadAllQR()">üì¶ T√ºm√ºn√º ƒ∞ndir</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h3 style="margin-bottom: 15px;">T√ºm Masalar i√ßin QR Kodlar</h3>
                <div id="allQRGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                </div>
            </div>
        </div>
        
        <!-- Raporlar -->
        <div id="reportsTab" class="content-section" style="display: none;">
            <h2 style="margin-bottom: 20px;">Raporlar ve ƒ∞statistikler</h2>
            
            <!-- <div class="report-filters">
                <button class="btn btn-primary" onclick="loadReports('daily')">G√ºnl√ºk</button>
                <button class="btn btn-primary" onclick="loadReports('weekly')">Haftalƒ±k</button>
                <button class="btn btn-primary" onclick="loadReports('monthly')">Aylƒ±k</button>
                <button class="btn btn-primary" onclick="loadReports('yearly')">Yƒ±llƒ±k</button>
            </div> -->
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalOrders">0</div>
                    <div class="stat-label">Toplam Sipari≈ü</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalRevenue">0‚Ç∫</div>
                    <div class="stat-label">Toplam Gelir</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgOrderValue">0‚Ç∫</div>
                    <div class="stat-label">Ortalama Sipari≈ü</div>
                </div>
            </div>
            
            <h3 style="margin-bottom: 15px;">Son Sipari≈üler</h3>
            <table id="ordersTable">
                <thead>
                    <tr>
                        <th>Masa</th>
                        <th>Tarih</th>
                        <th>Durum</th>
                        <th>Tutar</th>
                    </tr>
                </thead>
                <tbody id="ordersTableBody"></tbody>
            </table>
        </div>
        
        <!-- Kullanƒ±cƒ± Y√∂netimi -->
        <div id="usersTab" class="content-section" style="display: none;">
            <h2 style="margin-bottom: 20px;">Kullanƒ±cƒ± Y√∂netimi</h2>
            
            <p style="color: #7f8c8d; padding: 20px; background: #ecf0f1; border-radius: 5px;">
                <strong>Mevcut Kullanƒ±cƒ±lar:</strong><br><br>
                ‚Ä¢ <strong>admin</strong> / admin123 (Admin)<br>
                ‚Ä¢ <strong>mutfak</strong> / mutfak123 (Mutfak)<br>
                ‚Ä¢ <strong>garson</strong> / garson123 (Garson)<br><br>
                Yeni kullanƒ±cƒ± eklemek i√ßin data/users.json dosyasƒ±nƒ± d√ºzenleyebilirsiniz.
            </p>
        </div>
    </div>

    <script>
        let menu = [];
        let categories = [];
        let orders = [];
        let currentImageMode = 'url';
        let editingItemId = null;

        // Verileri y√ºkle
        async function loadData() {
            try {
                const [menuRes, ordersRes] = await Promise.all([
                    fetch('/api/menu'),
                    fetch('/api/orders')
                ]);
                
                const menuData = await menuRes.json();
                const ordersData = await ordersRes.json();
                
                menu = menuData.menu;
                categories = menuData.categories;
                orders = ordersData.orders;
                
                populateCategories();
                renderMenu();
                loadReports('daily');
            } catch (error) {
                console.error('Veriler y√ºklenemedi:', error);
            }
        }

        // Kategorileri doldur
        function populateCategories() {
            const select = document.getElementById('itemCategory');
            select.innerHTML = categories.map(cat => 
                `<option value="${cat.id}">${cat.name}</option>`
            ).join('');
        }

        // Resim modunu deƒüi≈ütir
        function switchImageMode(mode) {
            currentImageMode = mode;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (mode === 'url') {
                document.getElementById('urlMode').style.display = 'block';
                document.getElementById('uploadMode').style.display = 'none';
            } else {
                document.getElementById('urlMode').style.display = 'none';
                document.getElementById('uploadMode').style.display = 'block';
            }
        }

        // Resim √∂nizleme
        function previewImage() {
            const file = document.getElementById('itemImageFile').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // Men√ºy√º render et
        function renderMenu() {
            const container = document.getElementById('menuList');
            
            container.innerHTML = '<h3 style="margin: 20px 0;">Mevcut √úr√ºnler</h3>' + 
                menu.map(item => {
                    const category = categories.find(c => c.id === item.category);
                    return `
                        <div class="menu-item-row">
                            <div class="menu-item-info">
                                <img src="${item.image || 'https://via.placeholder.com/80x60?text=Resim'}" 
                                     class="menu-item-image-small"
                                     onerror="this.src='https://via.placeholder.com/80x60?text=Resim'">
                                <div>
                                    <strong>${item.name}</strong><br>
                                    <span style="color: #27ae60; font-weight: bold;">${item.price} ‚Ç∫</span>
                                    <span style="color: #7f8c8d;"> ‚Ä¢ ${category ? category.name : ''}</span>
                                </div>
                            </div>
                            <div class="menu-item-actions">
                                <button class="btn btn-success" onclick="editMenuItem('${item.id}')">D√ºzenle</button>
                                <button class="btn btn-danger" onclick="deleteMenuItem('${item.id}')">Sil</button>
                            </div>
                        </div>
                    `;
                }).join('');
        }

        // √úr√ºn d√ºzenle
        function editMenuItem(itemId) {
            const item = menu.find(m => m.id === itemId);
            if (!item) return;
            
            editingItemId = itemId;
            document.getElementById('itemId').value = itemId;
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemPrice').value = item.price;
            document.getElementById('itemCategory').value = item.category;
            document.getElementById('itemImageUrl').value = item.image || '';
            
            if (item.image) {
                document.getElementById('previewImg').src = item.image;
                document.getElementById('imagePreview').style.display = 'block';
            }
            
            document.getElementById('submitBtn').textContent = 'G√ºncelle';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Formu sƒ±fƒ±rla
        function resetForm() {
            editingItemId = null;
            document.getElementById('menuForm').reset();
            document.getElementById('itemId').value = '';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('submitBtn').textContent = '√úr√ºn Ekle';
        }

        // Men√º formu g√∂nder
        document.getElementById('menuForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            let imageUrl = '';
            
            if (currentImageMode === 'url') {
                imageUrl = document.getElementById('itemImageUrl').value;
            } else {
                const file = document.getElementById('itemImageFile').files[0];
                if (file) {
                    // Base64'e √ßevir
                    const reader = new FileReader();
                    imageUrl = await new Promise((resolve) => {
                        reader.onload = (e) => resolve(e.target.result);
                        reader.readAsDataURL(file);
                    });
                }
            }
            
            const item = {
                id: document.getElementById('itemId').value || undefined,
                name: document.getElementById('itemName').value,
                price: parseFloat(document.getElementById('itemPrice').value),
                category: document.getElementById('itemCategory').value,
                image: imageUrl
            };
            
            try {
                const response = await fetch('/api/menu', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(item)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(editingItemId ? '√úr√ºn g√ºncellendi!' : '√úr√ºn eklendi!');
                    resetForm();
                    loadData();
                }
            } catch (error) {
                alert('ƒ∞≈ülem ba≈üarƒ±sƒ±z!');
            }
        });

        // Men√º √∂ƒüesi sil
        async function deleteMenuItem(itemId) {
            if (!confirm('Bu √ºr√ºn√º silmek istediƒüinizden emin misiniz?')) return;
            
            try {
                const response = await fetch(`/api/menu/${itemId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('√úr√ºn silindi!');
                    loadData();
                }
            } catch (error) {
                alert('√úr√ºn silinemedi!');
            }
        }

        // Raporlarƒ± y√ºkle
        async function loadReports(period) {
            try {
                const response = await fetch(`/api/reports?period=${period}`);
                const data = await response.json();
                
                document.getElementById('totalOrders').textContent = data.total_orders;
                document.getElementById('totalRevenue').textContent = data.total_revenue + '‚Ç∫';
                
                const avgValue = data.total_orders > 0 ? 
                    Math.round(data.total_revenue / data.total_orders) : 0;
                document.getElementById('avgOrderValue').textContent = avgValue + '‚Ç∫';
                
                // Sipari≈ü tablosunu doldur
                const tbody = document.getElementById('ordersTableBody');
                const recentOrders = orders.slice(-10).reverse();
                
                tbody.innerHTML = recentOrders.map(order => {
                    const statusText = {
                        'pending': 'Bekliyor',
                        'preparing': 'Hazƒ±rlanƒ±yor',
                        'ready': 'Hazƒ±r',
                        'delivered': 'Teslim Edildi'
                    }[order.status];
                    
                    return `
                        <tr>
                            <td>Masa ${order.table_number}</td>
                            <td>${new Date(order.created_at).toLocaleString('tr-TR')}</td>
                            <td>${statusText}</td>
                            <td><strong>${order.total} ‚Ç∫</strong></td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Raporlar y√ºklenemedi:', error);
            }
        }

        // Tab deƒüi≈ütir
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('menuTab').style.display = 'none';
            document.getElementById('qrTab').style.display = 'none';
            document.getElementById('reportsTab').style.display = 'none';
            document.getElementById('usersTab').style.display = 'none';
            
            document.getElementById(tab + 'Tab').style.display = 'block';
            
            // QR tab a√ßƒ±ldƒ±ƒüƒ±nda masalarƒ± y√ºkle
            if (tab === 'qr') {
                loadQRTables();
            }
        }
        
        // QR i√ßin masalarƒ± y√ºkle
        async function loadQRTables() {
            try {
                const response = await fetch('/api/tables');
                const data = await response.json();
                
                const select = document.getElementById('qrTableSelect');
                select.innerHTML = '<option value="">Masa se√ßin...</option>';
                
                data.tables.forEach(table => {
                    const option = document.createElement('option');
                    option.value = table.number;
                    option.textContent = `Masa ${table.number}`;
                    select.appendChild(option);
                });
                
                // T√ºm QR kodlarƒ± grid'e ekle
                renderAllQRCodes(data.tables.length);
            } catch (error) {
                console.error('Masalar y√ºklenemedi:', error);
            }
        }
        
        // T√ºm QR kodlarƒ± g√∂ster
        function renderAllQRCodes(tableCount) {
            const grid = document.getElementById('allQRGrid');
            let html = '';
            
            for (let i = 1; i <= Math.min(tableCount, 30); i++) {
                html += `
                    <div style="background: white; padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                        <strong style="display: block; margin-bottom: 10px;">Masa ${i}</strong>
                        <div style="font-size: 50px; margin: 15px 0;">üçΩÔ∏è</div>
                        <div id="mini-qr-${i}" style="min-height: 100px;"></div>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 10px; padding: 8px; font-size: 14px;" onclick="generateQRForTable(${i})">
                            G√∂r√ºnt√ºle
                        </button>
                    </div>
                `;
            }
            
            grid.innerHTML = html;
        }
        
        // Se√ßili masa i√ßin QR olu≈ütur
        async function generateQR() {
            const tableNumber = document.getElementById('qrTableSelect').value;
            
            if (!tableNumber) {
                alert('L√ºtfen masa se√ßin!');
                return;
            }
            
            await generateQRForTable(parseInt(tableNumber));
        }
        
        // Belirli masa i√ßin QR olu≈ütur
        async function generateQRForTable(tableNumber) {
            try {
                const response = await fetch(`/api/qr/${tableNumber}`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('qrImage').src = data.qr_code;
                    document.getElementById('qrTableNumber').textContent = tableNumber;
                    document.getElementById('qrUrl').textContent = data.url;
                    document.getElementById('qrResult').style.display = 'block';
                    
                    // Sayfa ortasƒ±na scroll
                    document.getElementById('qrResult').scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            } catch (error) {
                alert('QR kod olu≈üturulamadƒ±!');
            }
        }
        
        // QR kodu indir
        function downloadQR() {
            const img = document.getElementById('qrImage');
            const tableNumber = document.getElementById('qrTableNumber').textContent;
            
            const link = document.createElement('a');
            link.href = img.src;
            link.download = `masa-${tableNumber}-qr.png`;
            link.click();
        }
        
        // QR kodu yazdƒ±r
        function printQR() {
            const img = document.getElementById('qrImage').src;
            const tableNumber = document.getElementById('qrTableNumber').textContent;
            const url = document.getElementById('qrUrl').textContent;
            
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Masa ${tableNumber} QR Kod</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            text-align: center;
                            padding: 50px;
                        }
                        h1 { color: #2c3e50; margin-bottom: 30px; }
                        img { border: 3px solid #ecf0f1; padding: 20px; margin: 20px 0; }
                        p { color: #7f8c8d; }
                    </style>
                </head>
                <body>
                    <h1>üçΩÔ∏è Restoran Y√∂netim Sistemi</h1>
                    <h2>Masa ${tableNumber}</h2>
                    <img src="${img}" alt="QR Kod">
                    <p>Sipari≈ü vermek i√ßin QR kodu okutun</p>
                    <p style="font-size: 12px;">${url}</p>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // T√ºm QR kodlarƒ± indir (ZIP olarak)
        async function downloadAllQR() {
            alert('T√ºm QR kodlarƒ± indiriliyor... Her masayƒ± tek tek indirmek i√ßin "G√∂r√ºnt√ºle" > "ƒ∞ndir" butonlarƒ±nƒ± kullanƒ±n.');
            
            // Her masa i√ßin QR olu≈ütur ve indir
            for (let i = 1; i <= 30; i++) {
                try {
                    const response = await fetch(`/api/qr/${i}`);
                    const data = await response.json();
                    
                    if (data.success) {
                        const link = document.createElement('a');
                        link.href = data.qr_code;
                        link.download = `masa-${i}-qr.png`;
                        link.click();
                        
                        // Tarayƒ±cƒ± engellemesini √∂nlemek i√ßin bekleme
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                } catch (error) {
                    console.error(`Masa ${i} QR kodu indirilemedi:`, error);
                }
            }
        }

        // √áƒ±kƒ±≈ü yap
        async function logout() {
            await fetch('/api/logout', { method: 'POST' });
            window.location.href = '/';
        }

        // Sayfa y√ºklendiƒüinde"
        loadData();
    </script>
</body>
</html>